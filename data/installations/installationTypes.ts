import { BigNumber } from "ethers";
import { ethers } from "hardhat";
import { InstallationTypeInput, InstallationTypeOutput } from "../../types";

export const installationTypes: InstallationTypeInput[] = [
  {
    id: 0,
    name: "The Void",
    level: 1,
    nextLevelId: 0,
    prerequisites: [],
    width: 1,
    height: 1,
    deprecated: true,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [0, 0, 0, 0],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 0,
    spillRate: 0,
    upgradeQueueBoost: 0,
    craftTime: 0,
    deprecateTime: 0,
  },
  {
    id: 1,
    name: "LE Golden Aaltar",
    level: 1,
    nextLevelId: 2,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [3000, 1500, 2000, 750],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 9000,
    spillRate: 50,
    upgradeQueueBoost: 1,
    craftTime: 0,
    deprecateTime: 0,
  },
  {
    id: 2,
    name: "LE Golden Aaltar",
    level: 2,
    nextLevelId: 3,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [300, 150, 75, 10],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 8000,
    spillRate: 45,
    upgradeQueueBoost: 1,
    craftTime: 65000,
    deprecateTime: 0,
  },
  {
    id: 3,
    name: "LE Golden Aaltar",
    level: 3,
    nextLevelId: 4,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [600, 300, 150, 20],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 7000,
    spillRate: 40,
    upgradeQueueBoost: 1,
    craftTime: 160000,
    deprecateTime: 0,
  },
  {
    id: 4,
    name: "LE Golden Aaltar",
    level: 4,
    nextLevelId: 5,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [1000, 750, 375, 100],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 6000,
    spillRate: 35,
    upgradeQueueBoost: 1,
    craftTime: 320000,
    deprecateTime: 0,
  },
  {
    id: 5,
    name: "LE Golden Aaltar",
    level: 5,
    nextLevelId: 6,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [2000, 1500, 750, 200],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 5000,
    spillRate: 30,
    upgradeQueueBoost: 1,
    craftTime: 475000,
    deprecateTime: 0,
  },
  {
    id: 6,
    name: "LE Golden Aaltar",
    level: 6,
    nextLevelId: 7,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [4000, 3000, 1500, 400],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 4000,
    spillRate: 25,
    upgradeQueueBoost: 1,
    craftTime: 630000,
    deprecateTime: 0,
  },
  {
    id: 7,
    name: "LE Golden Aaltar",
    level: 7,
    nextLevelId: 8,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [5000, 7500, 3750, 1500],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 3000,
    spillRate: 20,
    upgradeQueueBoost: 1,
    craftTime: 1250000,
    deprecateTime: 0,
  },
  {
    id: 8,
    name: "LE Golden Aaltar",
    level: 8,
    nextLevelId: 9,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [10000, 15000, 7500, 3000],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 2000,
    spillRate: 15,
    upgradeQueueBoost: 1,
    craftTime: 1900000,
    deprecateTime: 0,
  },
  {
    id: 9,
    name: "LE Golden Aaltar",
    level: 9,
    nextLevelId: 0,
    prerequisites: [],
    width: 2,
    height: 2,
    deprecated: false,
    installationType: 0,
    alchemicaType: 0,
    alchemicaCost: [20000, 30000, 15000, 6000],
    harvestRate: 0,
    capacity: 0,
    spillRadius: 1000,
    spillRate: 10,
    upgradeQueueBoost: 1,
    craftTime: 3200000,
    deprecateTime: 0,
  },
];

export function outputInstallation(
  installation: InstallationTypeInput
): InstallationTypeOutput {
  if (installation.width > 64) throw new Error("Width too much");
  if (installation.height > 64) throw new Error("Height too much");

  const alchemica = installation.alchemicaCost.map((val) =>
    ethers.utils.parseEther(val.toString())
  );

  let output: InstallationTypeOutput = {
    deprecated: installation.deprecated,
    installationType: installation.installationType,
    level: installation.level,
    width: installation.width,
    height: installation.height,
    alchemicaType: installation.alchemicaType,
    alchemicaCost: [
      BigNumber.from(alchemica[0]),
      BigNumber.from(alchemica[1]),
      BigNumber.from(alchemica[2]),
      BigNumber.from(alchemica[3]),
    ],
    harvestRate: ethers.utils.parseEther(installation.harvestRate.toString()),
    capacity: ethers.utils.parseEther(installation.capacity.toString()),
    spillRadius: installation.spillRadius.toString(),
    spillRate: (installation.spillRate * 1000).toString(), //add on 3 zeroes for precision
    upgradeQueueBoost: installation.upgradeQueueBoost,
    craftTime: installation.craftTime,
    nextLevelId: installation.nextLevelId,
    prerequisites: installation.prerequisites,
    name: installation.name,
    deprecateTime: installation.deprecateTime,
  };

  return output;
}
